{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "Setup Package Structure and PSR-4 Skeleton",
        "description": "Create the initial package structure following PSR-4 standards with all necessary configuration files and service provider",
        "details": "1. Create package root directory structure:\n   - src/ (main source code)\n   - config/ (configuration files)\n   - database/migrations/ (migration files)\n   - routes/ (API routes)\n   - tests/ (test files)\n\n2. Create composer.json with PSR-4 autoload:\n```json\n{\n  \"name\": \"vendor/auth-api\",\n  \"type\": \"library\",\n  \"require\": {\n    \"php\": \"^8.0\",\n    \"laravel/framework\": \"^9.0|^10.0|^11.0\",\n    \"laravel/passport\": \"^11.0\"\n  },\n  \"autoload\": {\n    \"psr-4\": {\n      \"Vendor\\\\AuthApi\\\\\": \"src/\"\n    }\n  },\n  \"extra\": {\n    \"laravel\": {\n      \"providers\": [\n        \"Vendor\\\\AuthApi\\\\AuthApiServiceProvider\"\n      ]\n    }\n  }\n}\n```\n\n3. Create AuthApiServiceProvider.php in src/:\n```php\nnamespace Vendor\\AuthApi;\n\nuse Illuminate\\Support\\ServiceProvider;\n\nclass AuthApiServiceProvider extends ServiceProvider\n{\n    public function register()\n    {\n        $this->mergeConfigFrom(__DIR__.'/../config/auth-api.php', 'auth-api');\n    }\n\n    public function boot()\n    {\n        $this->loadRoutesFrom(__DIR__.'/../routes/api.php');\n        $this->loadMigrationsFrom(__DIR__.'/../database/migrations');\n        \n        $this->publishes([\n            __DIR__.'/../config/auth-api.php' => config_path('auth-api.php'),\n        ], 'auth-api-config');\n        \n        $this->publishes([\n            __DIR__.'/../database/migrations' => database_path('migrations'),\n        ], 'auth-api-migrations');\n        \n        if ($this->app->runningInConsole()) {\n            $this->commands([\n                Commands\\InstallCommand::class,\n            ]);\n        }\n    }\n}\n```\n\n4. Create config/auth-api.php with basic structure (will be populated in task 6)",
        "testStrategy": "1. Verify directory structure is created correctly\n2. Run composer validate to ensure composer.json is valid\n3. Test autoload by running composer dump-autoload\n4. Verify ServiceProvider is discoverable by Laravel\n5. Test that config and migration publishing commands work: php artisan vendor:publish --tag=auth-api-config",
        "priority": "high",
        "dependencies": [],
        "status": "in-progress",
        "subtasks": [],
        "updatedAt": "2025-11-18T00:27:01.952Z"
      },
      {
        "id": "2",
        "title": "Create Installation Command with Passport Integration",
        "description": "Implement auth-api:install command that automatically installs and configures Laravel Passport with password grant and refresh token clients",
        "details": "Create src/Commands/InstallCommand.php:\n```php\nnamespace Vendor\\AuthApi\\Commands;\n\nuse Illuminate\\Console\\Command;\nuse Illuminate\\Support\\Facades\\Artisan;\nuse Illuminate\\Support\\Str;\n\nclass InstallCommand extends Command\n{\n    protected $signature = 'auth-api:install';\n    protected $description = 'Install and configure Auth API package with Passport';\n\n    public function handle()\n    {\n        $this->info('Installing Auth API Package...');\n        \n        // Install Passport\n        $this->info('Installing Laravel Passport...');\n        Artisan::call('passport:install', ['--force' => true]);\n        $this->info(Artisan::output());\n        \n        // Publish config\n        $this->info('Publishing configuration...');\n        Artisan::call('vendor:publish', ['--tag' => 'auth-api-config', '--force' => true]);\n        \n        // Publish migrations\n        $this->info('Publishing migrations...');\n        Artisan::call('vendor:publish', ['--tag' => 'auth-api-migrations', '--force' => true]);\n        \n        // Run migrations\n        if ($this->confirm('Do you want to run migrations now?', true)) {\n            Artisan::call('migrate');\n            $this->info('Migrations completed.');\n        }\n        \n        // Create password grant client\n        $this->info('Creating password grant client...');\n        Artisan::call('passport:client', ['--password' => true, '--name' => 'Auth API Password Grant']);\n        \n        // Extract client credentials and update .env\n        $this->updateEnvFile();\n        \n        $this->info('‚úÖ Auth API Package installed successfully!');\n        $this->displayDocumentation();\n    }\n    \n    protected function updateEnvFile()\n    {\n        // Logic to extract client ID and secret from database\n        // and append to .env file\n        $client = \\Laravel\\Passport\\Client::where('password_client', 1)->latest()->first();\n        \n        if ($client) {\n            $envPath = base_path('.env');\n            $envContent = file_get_contents($envPath);\n            \n            if (!Str::contains($envContent, 'PASSPORT_PASSWORD_CLIENT_ID')) {\n                file_put_contents($envPath, \"\\nPASSPORT_PASSWORD_CLIENT_ID={$client->id}\\n\", FILE_APPEND);\n                file_put_contents($envPath, \"PASSPORT_PASSWORD_CLIENT_SECRET={$client->secret}\\n\", FILE_APPEND);\n                $this->info('Environment variables added to .env');\n            }\n        }\n    }\n    \n    protected function displayDocumentation()\n    {\n        $this->newLine();\n        $this->line('üìò Quick Start:');\n        $this->line('1. Add HasApiTokens trait to your User model');\n        $this->line('2. Configure config/auth-api.php');\n        $this->line('3. API endpoints available at:');\n        $this->line('   - POST /api/auth/login');\n        $this->line('   - POST /api/auth/refresh');\n        $this->line('   - POST /api/auth/logout');\n        $this->line('   - POST /api/auth/logout-all');\n        $this->line('   - GET /api/auth/me');\n    }\n}\n```",
        "testStrategy": "1. Test command registration: php artisan list | grep auth-api:install\n2. Run installation in test Laravel app: php artisan auth-api:install\n3. Verify Passport is installed and passport tables exist\n4. Verify password grant client is created in oauth_clients table\n5. Verify .env file contains PASSPORT_PASSWORD_CLIENT_ID and PASSPORT_PASSWORD_CLIENT_SECRET\n6. Verify config file is published to config/auth-api.php\n7. Test idempotency - running command twice should not break",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "3",
        "title": "Create Database Migrations for Session Logs and Brute-Force Protection",
        "description": "Create migrations for login session tracking and failed login attempts tracking for anti brute-force protection",
        "details": "Create two migration files in database/migrations/:\n\n1. xxxx_xx_xx_create_api_login_sessions_table.php:\n```php\nuse Illuminate\\Database\\Migrations\\Migration;\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Support\\Facades\\Schema;\n\nreturn new class extends Migration\n{\n    public function up()\n    {\n        Schema::create('api_login_sessions', function (Blueprint $table) {\n            $table->id();\n            $table->foreignId('user_id')->constrained()->onDelete('cascade');\n            $table->string('token_id')->unique();\n            $table->string('device_name')->nullable();\n            $table->string('ip_address', 45);\n            $table->text('user_agent')->nullable();\n            $table->timestamp('last_used_at')->nullable();\n            $table->timestamp('expires_at')->nullable();\n            $table->timestamps();\n            \n            $table->index(['user_id', 'token_id']);\n        });\n    }\n\n    public function down()\n    {\n        Schema::dropIfExists('api_login_sessions');\n    }\n};\n```\n\n2. xxxx_xx_xx_create_api_login_attempts_table.php:\n```php\nuse Illuminate\\Database\\Migrations\\Migration;\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Support\\Facades\\Schema;\n\nreturn new class extends Migration\n{\n    public function up()\n    {\n        Schema::create('api_login_attempts', function (Blueprint $table) {\n            $table->id();\n            $table->string('email');\n            $table->string('ip_address', 45);\n            $table->boolean('successful')->default(false);\n            $table->timestamp('attempted_at');\n            $table->timestamp('blocked_until')->nullable();\n            $table->timestamps();\n            \n            $table->index(['email', 'ip_address', 'attempted_at']);\n            $table->index('blocked_until');\n        });\n    }\n\n    public function down()\n    {\n        Schema::dropIfExists('api_login_attempts');\n    }\n};\n```\n\n3. Create corresponding Eloquent models:\n   - src/Models/ApiLoginSession.php\n   - src/Models/ApiLoginAttempt.php",
        "testStrategy": "1. Run migrations: php artisan migrate\n2. Verify tables are created in database\n3. Check table structure matches schema\n4. Test foreign key constraints work correctly\n5. Verify indexes are created for performance\n6. Test rollback: php artisan migrate:rollback\n7. Create model instances to verify Eloquent relationships work",
        "priority": "medium",
        "dependencies": [
          "1"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "4",
        "title": "Implement Configuration File with All Settings",
        "description": "Create comprehensive configuration file for token TTL, security settings, logging, brute-force protection, and customizable messages",
        "details": "Create config/auth-api.php with all configurable options:\n```php\nreturn [\n    // Token expiration times\n    'access_token_ttl' => env('AUTH_API_ACCESS_TOKEN_TTL', 60), // minutes\n    'refresh_token_ttl' => env('AUTH_API_REFRESH_TOKEN_TTL', 43200), // minutes (30 days)\n    \n    // User model configuration\n    'user_model' => env('AUTH_API_USER_MODEL', 'App\\\\Models\\\\User'),\n    'user_table' => env('AUTH_API_USER_TABLE', 'users'),\n    \n    // Session logging\n    'enable_session_logging' => env('AUTH_API_ENABLE_SESSION_LOGGING', true),\n    \n    // Brute-force protection\n    'enable_brute_force_protection' => env('AUTH_API_ENABLE_BRUTE_FORCE', true),\n    'max_login_attempts' => env('AUTH_API_MAX_LOGIN_ATTEMPTS', 5),\n    'lockout_duration' => env('AUTH_API_LOCKOUT_DURATION', 15), // minutes\n    \n    // Rate limiting\n    'rate_limit' => [\n        'login' => env('AUTH_API_RATE_LIMIT_LOGIN', '5,1'), // 5 attempts per minute\n        'refresh' => env('AUTH_API_RATE_LIMIT_REFRESH', '10,1'),\n        'general' => env('AUTH_API_RATE_LIMIT_GENERAL', '60,1'),\n    ],\n    \n    // Security\n    'https_only' => env('AUTH_API_HTTPS_ONLY', true),\n    'revoke_old_refresh_token' => env('AUTH_API_REVOKE_OLD_REFRESH', true),\n    'enable_jwt_signature' => env('AUTH_API_JWT_SIGNATURE', false),\n    \n    // Passport scopes\n    'scopes' => [\n        'user' => 'Access user data',\n        'admin' => 'Administrative access',\n    ],\n    \n    // Client credentials for server-to-server\n    'enable_client_credentials' => env('AUTH_API_CLIENT_CREDENTIALS', false),\n    \n    // Custom messages\n    'messages' => [\n        'login_success' => 'Login successful',\n        'login_failed' => 'Invalid credentials',\n        'account_locked' => 'Account temporarily locked due to too many failed attempts',\n        'token_expired' => 'Token has expired',\n        'token_invalid' => 'Invalid token',\n        'logout_success' => 'Logged out successfully',\n        'unauthorized' => 'Unauthorized access',\n    ],\n    \n    // Routes configuration\n    'routes' => [\n        'prefix' => env('AUTH_API_ROUTE_PREFIX', 'api/auth'),\n        'middleware' => ['api'],\n    ],\n];\n```",
        "testStrategy": "1. Verify config file can be loaded: config('auth-api')\n2. Test all default values are set correctly\n3. Test environment variable overrides work\n4. Verify config caching works: php artisan config:cache\n5. Test that invalid values are handled gracefully\n6. Verify all config keys are accessible in application code",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "5",
        "title": "Create Security Middleware for Token Validation and Rate Limiting",
        "description": "Implement middleware for token validation, scope checking, rate limiting per IP and user, and brute-force protection",
        "details": "Create multiple middleware classes in src/Middleware/:\n\n1. EnsureTokenIsValid.php:\n```php\nnamespace Vendor\\AuthApi\\Middleware;\n\nuse Closure;\nuse Illuminate\\Http\\Request;\nuse Laravel\\Passport\\TokenRepository;\n\nclass EnsureTokenIsValid\n{\n    protected $tokenRepository;\n    \n    public function __construct(TokenRepository $tokenRepository)\n    {\n        $this->tokenRepository = $tokenRepository;\n    }\n    \n    public function handle(Request $request, Closure $next)\n    {\n        if (!$request->user()) {\n            return response()->json([\n                'message' => config('auth-api.messages.unauthorized')\n            ], 401);\n        }\n        \n        $token = $request->user()->token();\n        \n        if ($token->revoked || $token->expires_at->isPast()) {\n            return response()->json([\n                'message' => config('auth-api.messages.token_expired')\n            ], 401);\n        }\n        \n        return $next($request);\n    }\n}\n```\n\n2. CheckScopes.php:\n```php\nnamespace Vendor\\AuthApi\\Middleware;\n\nuse Closure;\nuse Illuminate\\Http\\Request;\n\nclass CheckScopes\n{\n    public function handle(Request $request, Closure $next, ...$scopes)\n    {\n        if (!$request->user() || !$request->user()->tokenCan($scopes[0])) {\n            return response()->json([\n                'message' => 'Insufficient permissions'\n            ], 403);\n        }\n        \n        return $next($request);\n    }\n}\n```\n\n3. ThrottleLogin.php:\n```php\nnamespace Vendor\\AuthApi\\Middleware;\n\nuse Closure;\nuse Illuminate\\Cache\\RateLimiter;\nuse Illuminate\\Http\\Request;\nuse Vendor\\AuthApi\\Models\\ApiLoginAttempt;\n\nclass ThrottleLogin\n{\n    protected $limiter;\n    \n    public function __construct(RateLimiter $limiter)\n    {\n        $this->limiter = $limiter;\n    }\n    \n    public function handle(Request $request, Closure $next)\n    {\n        if (!config('auth-api.enable_brute_force_protection')) {\n            return $next($request);\n        }\n        \n        $key = $this->throttleKey($request);\n        $maxAttempts = config('auth-api.max_login_attempts');\n        $decayMinutes = config('auth-api.lockout_duration');\n        \n        // Check if blocked\n        $blocked = ApiLoginAttempt::where('email', $request->email)\n            ->where('ip_address', $request->ip())\n            ->where('blocked_until', '>', now())\n            ->exists();\n            \n        if ($blocked || $this->limiter->tooManyAttempts($key, $maxAttempts)) {\n            return response()->json([\n                'message' => config('auth-api.messages.account_locked'),\n                'retry_after' => $this->limiter->availableIn($key)\n            ], 429);\n        }\n        \n        $this->limiter->hit($key, $decayMinutes * 60);\n        \n        return $next($request);\n    }\n    \n    protected function throttleKey(Request $request): string\n    {\n        return strtolower($request->input('email')).'|'.$request->ip();\n    }\n}\n```\n\n4. Register middleware in ServiceProvider",
        "testStrategy": "1. Test EnsureTokenIsValid with valid token - should pass\n2. Test with expired token - should return 401\n3. Test with revoked token - should return 401\n4. Test CheckScopes with correct scope - should pass\n5. Test CheckScopes with wrong scope - should return 403\n6. Test ThrottleLogin under limit - should pass\n7. Test ThrottleLogin over limit - should return 429\n8. Test rate limiting resets after decay period\n9. Test IP-based blocking works correctly\n10. Test middleware can be disabled via config",
        "priority": "high",
        "dependencies": [
          "3",
          "4"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "6",
        "title": "Implement Authentication Controller with Login Endpoint",
        "description": "Create authentication controller with login endpoint that validates credentials, issues tokens, and logs sessions",
        "details": "Create src/Http/Controllers/AuthController.php with login method:\n```php\nnamespace Vendor\\AuthApi\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Routing\\Controller;\nuse Illuminate\\Support\\Facades\\Hash;\nuse Illuminate\\Support\\Facades\\Http;\nuse Vendor\\AuthApi\\Models\\ApiLoginAttempt;\nuse Vendor\\AuthApi\\Models\\ApiLoginSession;\nuse Vendor\\AuthApi\\Events\\ApiUserLoggedIn;\n\nclass AuthController extends Controller\n{\n    public function login(Request $request)\n    {\n        $request->validate([\n            'email' => 'required|email',\n            'password' => 'required|string',\n            'device_name' => 'nullable|string',\n        ]);\n        \n        $userModel = config('auth-api.user_model');\n        $user = $userModel::where('email', $request->email)->first();\n        \n        // Log attempt\n        $this->logLoginAttempt($request->email, $request->ip(), false);\n        \n        if (!$user || !Hash::check($request->password, $user->password)) {\n            return response()->json([\n                'message' => config('auth-api.messages.login_failed')\n            ], 401);\n        }\n        \n        // Request tokens from Passport\n        $response = Http::asForm()->post(url('/oauth/token'), [\n            'grant_type' => 'password',\n            'client_id' => env('PASSPORT_PASSWORD_CLIENT_ID'),\n            'client_secret' => env('PASSPORT_PASSWORD_CLIENT_SECRET'),\n            'username' => $request->email,\n            'password' => $request->password,\n            'scope' => '*',\n        ]);\n        \n        if ($response->failed()) {\n            return response()->json([\n                'message' => config('auth-api.messages.login_failed')\n            ], 401);\n        }\n        \n        $tokens = $response->json();\n        \n        // Log successful attempt\n        $this->logLoginAttempt($request->email, $request->ip(), true);\n        \n        // Log session if enabled\n        if (config('auth-api.enable_session_logging')) {\n            $this->logSession($user, $request, $tokens['access_token']);\n        }\n        \n        // Clear rate limiting on success\n        $this->clearLoginAttempts($request->email, $request->ip());\n        \n        // Fire event\n        event(new ApiUserLoggedIn($user, $request->ip()));\n        \n        return response()->json([\n            'message' => config('auth-api.messages.login_success'),\n            'access_token' => $tokens['access_token'],\n            'refresh_token' => $tokens['refresh_token'],\n            'token_type' => 'Bearer',\n            'expires_in' => $tokens['expires_in'],\n            'user' => $user,\n        ]);\n    }\n    \n    protected function logLoginAttempt(string $email, string $ip, bool $successful)\n    {\n        if (!config('auth-api.enable_brute_force_protection')) {\n            return;\n        }\n        \n        ApiLoginAttempt::create([\n            'email' => $email,\n            'ip_address' => $ip,\n            'successful' => $successful,\n            'attempted_at' => now(),\n        ]);\n    }\n    \n    protected function logSession($user, Request $request, string $tokenId)\n    {\n        ApiLoginSession::create([\n            'user_id' => $user->id,\n            'token_id' => $tokenId,\n            'device_name' => $request->device_name,\n            'ip_address' => $request->ip(),\n            'user_agent' => $request->userAgent(),\n            'last_used_at' => now(),\n            'expires_at' => now()->addMinutes(config('auth-api.access_token_ttl')),\n        ]);\n    }\n    \n    protected function clearLoginAttempts(string $email, string $ip)\n    {\n        ApiLoginAttempt::where('email', $email)\n            ->where('ip_address', $ip)\n            ->delete();\n    }\n}\n```",
        "testStrategy": "1. Test login with valid credentials - should return tokens\n2. Test login with invalid email - should return 401\n3. Test login with invalid password - should return 401\n4. Test login attempt is logged in database\n5. Test successful login clears previous failed attempts\n6. Test session is logged when enabled\n7. Test ApiUserLoggedIn event is fired\n8. Test response includes all required fields\n9. Test device_name is stored when provided\n10. Test HTTPS enforcement when configured",
        "priority": "high",
        "dependencies": [
          "3",
          "4",
          "5"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "7",
        "title": "Implement Refresh Token, Logout, and Logout All Endpoints",
        "description": "Create endpoints for token refresh, single session logout, and logout from all sessions with proper token revocation",
        "details": "Add methods to src/Http/Controllers/AuthController.php:\n\n```php\npublic function refresh(Request $request)\n{\n    $request->validate([\n        'refresh_token' => 'required|string',\n    ]);\n    \n    $response = Http::asForm()->post(url('/oauth/token'), [\n        'grant_type' => 'refresh_token',\n        'refresh_token' => $request->refresh_token,\n        'client_id' => env('PASSPORT_PASSWORD_CLIENT_ID'),\n        'client_secret' => env('PASSPORT_PASSWORD_CLIENT_SECRET'),\n        'scope' => '*',\n    ]);\n    \n    if ($response->failed()) {\n        return response()->json([\n            'message' => config('auth-api.messages.token_invalid')\n        ], 401);\n    }\n    \n    $tokens = $response->json();\n    \n    // Revoke old refresh token if configured\n    if (config('auth-api.revoke_old_refresh_token')) {\n        $this->revokeRefreshToken($request->refresh_token);\n    }\n    \n    // Fire event\n    event(new \\Vendor\\AuthApi\\Events\\ApiTokenRefreshed($request->user()));\n    \n    return response()->json([\n        'access_token' => $tokens['access_token'],\n        'refresh_token' => $tokens['refresh_token'],\n        'token_type' => 'Bearer',\n        'expires_in' => $tokens['expires_in'],\n    ]);\n}\n\npublic function logout(Request $request)\n{\n    $token = $request->user()->token();\n    \n    // Revoke access token\n    $token->revoke();\n    \n    // Revoke associated refresh tokens\n    $tokenRepository = app(\\Laravel\\Passport\\TokenRepository::class);\n    $refreshTokenRepository = app(\\Laravel\\Passport\\RefreshTokenRepository::class);\n    \n    $refreshTokenRepository->revokeRefreshTokensByAccessTokenId($token->id);\n    \n    // Remove session log\n    if (config('auth-api.enable_session_logging')) {\n        ApiLoginSession::where('token_id', $token->id)->delete();\n    }\n    \n    // Fire event\n    event(new \\Vendor\\AuthApi\\Events\\ApiUserLoggedOut($request->user()));\n    \n    return response()->json([\n        'message' => config('auth-api.messages.logout_success')\n    ]);\n}\n\npublic function logoutAll(Request $request)\n{\n    $user = $request->user();\n    \n    // Revoke all tokens for user\n    $tokens = $user->tokens;\n    \n    foreach ($tokens as $token) {\n        $token->revoke();\n    }\n    \n    // Remove all session logs\n    if (config('auth-api.enable_session_logging')) {\n        ApiLoginSession::where('user_id', $user->id)->delete();\n    }\n    \n    // Fire event\n    event(new \\Vendor\\AuthApi\\Events\\ApiUserLoggedOut($user, true));\n    \n    return response()->json([\n        'message' => 'Logged out from all sessions successfully'\n    ]);\n}\n\npublic function me(Request $request)\n{\n    return response()->json([\n        'user' => $request->user(),\n    ]);\n}\n\nprotected function revokeRefreshToken(string $refreshToken)\n{\n    $refreshTokenRepository = app(\\Laravel\\Passport\\RefreshTokenRepository::class);\n    $refreshTokenRepository->revokeRefreshToken($refreshToken);\n}\n```",
        "testStrategy": "1. Test refresh with valid refresh_token - should return new tokens\n2. Test refresh with invalid refresh_token - should return 401\n3. Test old refresh token is revoked when configured\n4. Test logout revokes current access token\n5. Test logout revokes associated refresh tokens\n6. Test logout removes session log\n7. Test logout-all revokes all user tokens\n8. Test logout-all removes all session logs\n9. Test me endpoint returns authenticated user\n10. Test events are fired correctly\n11. Test revoked tokens cannot be used for subsequent requests",
        "priority": "high",
        "dependencies": [
          "6"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "8",
        "title": "Create API Routes with Middleware Protection",
        "description": "Define all authentication routes with appropriate middleware for rate limiting and token validation",
        "details": "Create routes/api.php:\n```php\nuse Illuminate\\Support\\Facades\\Route;\nuse Vendor\\AuthApi\\Http\\Controllers\\AuthController;\nuse Vendor\\AuthApi\\Middleware\\ThrottleLogin;\nuse Vendor\\AuthApi\\Middleware\\EnsureTokenIsValid;\n\n$prefix = config('auth-api.routes.prefix', 'api/auth');\n$middleware = config('auth-api.routes.middleware', ['api']);\n\nRoute::prefix($prefix)\n    ->middleware($middleware)\n    ->group(function () {\n        // Public routes with rate limiting\n        Route::post('/login', [AuthController::class, 'login'])\n            ->middleware(ThrottleLogin::class)\n            ->name('auth-api.login');\n        \n        Route::post('/refresh', [AuthController::class, 'refresh'])\n            ->middleware('throttle:'.config('auth-api.rate_limit.refresh'))\n            ->name('auth-api.refresh');\n        \n        // Protected routes\n        Route::middleware(['auth:api', EnsureTokenIsValid::class])->group(function () {\n            Route::post('/logout', [AuthController::class, 'logout'])\n                ->name('auth-api.logout');\n            \n            Route::post('/logout-all', [AuthController::class, 'logoutAll'])\n                ->name('auth-api.logout-all');\n            \n            Route::get('/me', [AuthController::class, 'me'])\n                ->name('auth-api.me');\n        });\n    });\n```\n\nRegister middleware aliases in ServiceProvider:\n```php\npublic function boot()\n{\n    // ... existing code ...\n    \n    $router = $this->app['router'];\n    $router->aliasMiddleware('auth-api.token', \\Vendor\\AuthApi\\Middleware\\EnsureTokenIsValid::class);\n    $router->aliasMiddleware('auth-api.scopes', \\Vendor\\AuthApi\\Middleware\\CheckScopes::class);\n    $router->aliasMiddleware('auth-api.throttle-login', \\Vendor\\AuthApi\\Middleware\\ThrottleLogin::class);\n}\n```",
        "testStrategy": "1. Test all routes are registered: php artisan route:list\n2. Test login route is accessible without authentication\n3. Test refresh route is accessible without authentication\n4. Test logout requires authentication - 401 without token\n5. Test logout-all requires authentication\n6. Test me requires authentication\n7. Test rate limiting works on login endpoint\n8. Test rate limiting works on refresh endpoint\n9. Test custom prefix from config is applied\n10. Test middleware stack is correct for each route",
        "priority": "medium",
        "dependencies": [
          "5",
          "7"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "9",
        "title": "Create Events for Extensibility Hooks",
        "description": "Implement events for login, logout, and token refresh to allow package consumers to hook into authentication lifecycle",
        "details": "Create event classes in src/Events/:\n\n1. ApiUserLoggedIn.php:\n```php\nnamespace Vendor\\AuthApi\\Events;\n\nuse Illuminate\\Foundation\\Events\\Dispatchable;\nuse Illuminate\\Queue\\SerializesModels;\n\nclass ApiUserLoggedIn\n{\n    use Dispatchable, SerializesModels;\n    \n    public $user;\n    public $ipAddress;\n    \n    public function __construct($user, string $ipAddress)\n    {\n        $this->user = $user;\n        $this->ipAddress = $ipAddress;\n    }\n}\n```\n\n2. ApiUserLoggedOut.php:\n```php\nnamespace Vendor\\AuthApi\\Events;\n\nuse Illuminate\\Foundation\\Events\\Dispatchable;\nuse Illuminate\\Queue\\SerializesModels;\n\nclass ApiUserLoggedOut\n{\n    use Dispatchable, SerializesModels;\n    \n    public $user;\n    public $allSessions;\n    \n    public function __construct($user, bool $allSessions = false)\n    {\n        $this->user = $user;\n        $this->allSessions = $allSessions;\n    }\n}\n```\n\n3. ApiTokenRefreshed.php:\n```php\nnamespace Vendor\\AuthApi\\Events;\n\nuse Illuminate\\Foundation\\Events\\Dispatchable;\nuse Illuminate\\Queue\\SerializesModels;\n\nclass ApiTokenRefreshed\n{\n    use Dispatchable, SerializesModels;\n    \n    public $user;\n    \n    public function __construct($user)\n    {\n        $this->user = $user;\n    }\n}\n```\n\n4. Document event usage in README:\n```php\n// Example: Listen to login events\nEvent::listen(\\Vendor\\AuthApi\\Events\\ApiUserLoggedIn::class, function ($event) {\n    Log::info('User logged in', [\n        'user_id' => $event->user->id,\n        'ip' => $event->ipAddress,\n    ]);\n});\n```",
        "testStrategy": "1. Test ApiUserLoggedIn event is fired on successful login\n2. Test event contains correct user and IP address\n3. Test ApiUserLoggedOut event is fired on logout\n4. Test allSessions flag is correct for logout vs logout-all\n5. Test ApiTokenRefreshed event is fired on token refresh\n6. Test events can be listened to in consuming application\n7. Test event listeners can access all event properties\n8. Test events work with queued listeners",
        "priority": "medium",
        "dependencies": [
          "6",
          "7"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "10",
        "title": "Implement Comprehensive Test Suite",
        "description": "Create automated tests using PHPUnit/Pest covering authentication flows, security features, and edge cases",
        "details": "Create tests in tests/ directory using Pest PHP:\n\n1. tests/Feature/LoginTest.php:\n```php\nuse Vendor\\AuthApi\\Models\\ApiLoginAttempt;\nuse function Pest\\Laravel\\postJson;\n\nit('can login with valid credentials', function () {\n    $user = User::factory()->create([\n        'email' => 'test@example.com',\n        'password' => bcrypt('password123'),\n    ]);\n    \n    $response = postJson('/api/auth/login', [\n        'email' => 'test@example.com',\n        'password' => 'password123',\n    ]);\n    \n    $response->assertOk()\n        ->assertJsonStructure([\n            'access_token',\n            'refresh_token',\n            'token_type',\n            'expires_in',\n            'user',\n        ]);\n});\n\nit('cannot login with invalid credentials', function () {\n    $response = postJson('/api/auth/login', [\n        'email' => 'test@example.com',\n        'password' => 'wrongpassword',\n    ]);\n    \n    $response->assertStatus(401);\n});\n\nit('blocks login after max attempts', function () {\n    config(['auth-api.enable_brute_force_protection' => true]);\n    config(['auth-api.max_login_attempts' => 3]);\n    \n    for ($i = 0; $i < 3; $i++) {\n        postJson('/api/auth/login', [\n            'email' => 'test@example.com',\n            'password' => 'wrong',\n        ]);\n    }\n    \n    $response = postJson('/api/auth/login', [\n        'email' => 'test@example.com',\n        'password' => 'wrong',\n    ]);\n    \n    $response->assertStatus(429);\n});\n```\n\n2. tests/Feature/RefreshTokenTest.php\n3. tests/Feature/LogoutTest.php\n4. tests/Feature/SecurityTest.php:\n```php\nit('rejects expired tokens', function () {\n    // Test implementation\n});\n\nit('rejects revoked tokens', function () {\n    // Test implementation\n});\n\nit('enforces rate limiting', function () {\n    // Test implementation\n});\n```\n\n5. tests/Unit/MiddlewareTest.php\n6. tests/Unit/EventTest.php\n\nCreate tests/TestCase.php and tests/Pest.php for setup",
        "testStrategy": "1. Run full test suite: ./vendor/bin/pest\n2. Verify all authentication flows are tested\n3. Verify security features are tested\n4. Verify edge cases are covered\n5. Achieve minimum 80% code coverage\n6. Test with different Laravel versions (9, 10, 11)\n7. Test with different PHP versions (8.0, 8.1, 8.2, 8.3)\n8. Run tests in CI/CD pipeline\n9. Generate coverage report: ./vendor/bin/pest --coverage\n10. Verify no memory leaks or performance issues",
        "priority": "high",
        "dependencies": [
          "8"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "11",
        "title": "Create Comprehensive Documentation and README",
        "description": "Write complete documentation covering installation, configuration, usage examples, API reference, and security best practices",
        "details": "Create comprehensive documentation:\n\n1. README.md:\n```markdown\n# Laravel Auth API Package\n\nA professional Laravel package for API authentication using Laravel Passport with built-in security features.\n\n## Features\n- üîê Complete authentication flow (login, refresh, logout)\n- üõ°Ô∏è Brute-force protection\n- üìä Session logging\n- ‚ö° Rate limiting\n- üéØ Scope-based permissions\n- üîÑ Refresh token rotation\n- üì± Multi-device support\n- üé® Fully configurable\n- üß™ Comprehensive test coverage\n\n## Requirements\n- PHP 8.0+\n- Laravel 9.0+\n- Laravel Passport\n\n## Installation\n```bash\ncomposer require vendor/auth-api\nphp artisan auth-api:install\n```\n\n## Configuration\nPublish and configure:\n```bash\nphp artisan vendor:publish --tag=auth-api-config\n```\n\n## Usage\n\n### Login\n```javascript\nfetch('/api/auth/login', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    email: 'user@example.com',\n    password: 'password',\n    device_name: 'iPhone 13'\n  })\n})\n```\n\n### Using Access Token\n```javascript\nfetch('/api/user', {\n  headers: {\n    'Authorization': 'Bearer ' + accessToken\n  }\n})\n```\n\n### Refresh Token\n```javascript\nfetch('/api/auth/refresh', {\n  method: 'POST',\n  body: JSON.stringify({ refresh_token: refreshToken })\n})\n```\n\n## API Reference\n[Detailed endpoint documentation]\n\n## Security Best Practices\n[Security recommendations]\n\n## Events\n[Event documentation]\n\n## Testing\n```bash\n./vendor/bin/pest\n```\n\n## License\nMIT\n```\n\n2. Create docs/ folder with:\n   - installation.md\n   - configuration.md\n   - usage.md\n   - api-reference.md\n   - security.md\n   - events.md\n   - troubleshooting.md\n\n3. Add inline code documentation (PHPDoc)\n4. Create CHANGELOG.md\n5. Create CONTRIBUTING.md\n6. Create LICENSE file",
        "testStrategy": "1. Verify README renders correctly on GitHub\n2. Test all code examples work as documented\n3. Verify installation instructions are complete\n4. Test configuration examples are valid\n5. Verify API examples match actual endpoints\n6. Check all links work\n7. Verify documentation is searchable\n8. Test examples with fresh Laravel installation\n9. Get feedback from beta users\n10. Ensure documentation covers all features",
        "priority": "medium",
        "dependencies": [
          "10"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "12",
        "title": "Prepare Package for Publication and CI/CD Setup",
        "description": "Finalize package structure, create GitHub repository, publish to Packagist, and setup automated testing with CI/CD",
        "details": "1. Verify PSR-4 compliance:\n   - Run composer validate\n   - Check namespace consistency\n   - Verify autoload configuration\n\n2. Create .github/workflows/tests.yml:\n```yaml\nname: Tests\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        php: [8.0, 8.1, 8.2, 8.3]\n        laravel: [9.*, 10.*, 11.*]\n    \n    steps:\n      - uses: actions/checkout@v3\n      - name: Setup PHP\n        uses: shivammathur/setup-php@v2\n        with:\n          php-version: ${{ matrix.php }}\n      - name: Install dependencies\n        run: composer install\n      - name: Run tests\n        run: ./vendor/bin/pest --coverage\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n```\n\n3. Create GitHub repository:\n   - Initialize git repository\n   - Create .gitignore\n   - Add remote origin\n   - Push initial commit\n   - Create releases (v0.1.0)\n   - Add topics/tags\n\n4. Publish to Packagist:\n   - Submit package to packagist.org\n   - Configure GitHub webhook\n   - Verify package is discoverable\n\n5. Add badges to README:\n   - Build status\n   - Code coverage\n   - Latest version\n   - Downloads\n   - License\n\n6. Create release notes\n7. Setup semantic versioning\n8. Configure Dependabot for dependency updates",
        "testStrategy": "1. Test package installation via Composer from Packagist\n2. Verify CI/CD pipeline runs successfully\n3. Test with different PHP/Laravel version combinations\n4. Verify code coverage is calculated correctly\n5. Test package discovery works: composer search auth-api\n6. Verify badges display correctly\n7. Test GitHub releases are created properly\n8. Verify webhook triggers Packagist updates\n9. Test package can be required in fresh Laravel project\n10. Verify all automated checks pass",
        "priority": "medium",
        "dependencies": [
          "11"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-11-18T00:27:01.953Z",
      "taskCount": 12,
      "completedCount": 0,
      "tags": [
        "master"
      ]
    }
  }
}